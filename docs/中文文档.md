#xpm规范

## 安装

```
npm install xpm2
```

## 集/包

所有的文件结构都是以`family/packname`的方式，packname下有若干文件或子目录和一个`package.js`包配置文件，而family下的`package.js`文件被所有包共享，如下:

```
    |- meteor
        |- deps
            |- package.js
            |- Dep.js    
        |- underscore
            |- underscore.js
            |- package.js
        |- package.js   //该文件会被deps和underscore包所引用
    |- xiami
        |- webapp
            |- package.js
            |- lib
                |- file1.js
                |- 
```    

## package.js 说明

每个package.js都是用于说明该包和其他包的依赖关系和需要加载的文件等，例如:

```javascript
//说明包的信息
Package.describe({
    info: "this is a mypack package."
    version: "0.0.1"
})
//在客户端和服务端都加载
Package.all({
    files: ["common.js"]
    test_files: ["test/**/*.js"]
})
//只在服务端加载
Package.server({
    imports: ['underscore', "xiami/webapp"]             
    files: ['file1.js', 'file2.js']
})
//只在客户端加载
Package.client({
    imports: ['underscore']             
    files: ['client*.js', "**/*.styl", "**/*.jpg"]
})
    
```

这里的 all/server/client 都可传入如下参数:

- imports {String | Array} 需要依赖的包，可以是 `family/packname` 模式 或者 单独`packname`，后者表示引用自同一个 `family`, 例如上例中的`["underscore", "xiami/webapp"]`等同于`["meteor/underscore", "xiami/webapp"]`
- test_imports {String | Array} 测试需要的依赖包, 格式同上
- files {String | Array} 需要加入的文件，格式支持[minimatch](https://github.com/isaacs/minimatch), 例如 `**/*.js`
   可加载`.coffee`, `.less`, `.styl`, `.tpl`,`.html`,`.jade`，还有`.jpg` `.png`等图像文件，具体可参见源码中`lib/plugins`目录下默认插件的`extnames`配置，默认的插件都对不同格式进行了相应编译处理。
- test_files {String | Array} 需要加入的测试文件，同上
- main {String} 主入口文件，默认为 `index.js`, 可省略`.js`, 如直接写 `index`,
- main_preload {Boolean} 是否加载包的时候自动执行主入口文件

##CommonJs规范的扩展

js文件支持`require/exports/module`书写模式，但CommonJs有以下不同：
- require("family/packname") 可以直接调用其他已引用的包, 默认加载的`package.js`下配置的`main`文件，支持server或client
- require("family/packname/any/path") 调用包的子路径文件，支持server或client
- require("path") 调用原生的包或者node_modules目录下的第三方包, 可用于server或client, client端的原生包在代码的`lib/browser/native`目录下，有如下：
    - es5-shim 默认已加载到全局，让客户端支持es5语法，如Function.prototype.bind
    - json2 默认已加载到全局, 让客户端支持JSON.stringify
    - xpm xpm包，后边会介绍
    - events, nodejs原生events在浏览器端支持
    - path, nodejs原生path
    - util, nodejs原生util
- require("any/path", true) 调用原生的包，只支持server端，如require("fibers/future", true)引用node_modules下的fibers模块

##server端使用方法

```javascript
var xpmServer = require('xpm2').serverCreate({
    //family 目录
    family: {
        meteor: __dirname + "/meteor",
        myfamily: "/any/real/path"
    }
})

var mypack = xpmServer.require('myfamily/mypack')
```

##client端方法

##插件扩展

